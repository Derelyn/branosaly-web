{"ast":null,"code":"import raf from 'raf';\nvar MODE;\n(function (MODE) {\n  MODE[MODE[\"MODE_TIMEOUT\"] = 0] = \"MODE_TIMEOUT\";\n  MODE[MODE[\"MODE_INTERVAL\"] = 1] = \"MODE_INTERVAL\";\n})(MODE || (MODE = {}));\nconst fnMap = new Map();\nconst executionSet = new Set();\nlet rafStarted = false;\nlet startId = 0;\nfunction getTimeStamp() {\n  return new Date().getTime();\n}\nfunction executeFn(value) {\n  const {\n    fn,\n    args\n  } = value;\n  fn(...args);\n}\nfunction runFunction() {\n  if (executionSet.size === 0) return;\n  executionSet.forEach(executeFn);\n  executionSet.clear();\n}\nconst checkTick = currentTimeTick => (value, id) => {\n  const {\n    nextTick,\n    ms,\n    mode\n  } = value;\n  if (currentTimeTick - nextTick >= 0) {\n    executionSet.add(value);\n    if (mode === MODE.MODE_TIMEOUT) {\n      fnMap.delete(id);\n    } else {\n      fnMap.set(id, {\n        ...value,\n        nextTick: nextTick + ms\n      });\n    }\n  }\n};\nfunction loop() {\n  if (fnMap.size === 0) {\n    rafStarted = false;\n    return;\n  }\n  const currentTimeTick = getTimeStamp();\n  fnMap.forEach(checkTick(currentTimeTick));\n  runFunction();\n  if (fnMap.size === 0) {\n    rafStarted = false;\n    return;\n  }\n  raf(loop);\n}\nfunction addId(_ref) {\n  let {\n    fn,\n    ms,\n    args,\n    mode\n  } = _ref;\n  if (!fn) return null;\n  const currentId = startId;\n  fnMap.set(currentId, {\n    fn,\n    ms,\n    nextTick: getTimeStamp() + ms,\n    args,\n    mode\n  });\n  if (!rafStarted) {\n    rafStarted = true;\n    raf(loop);\n  }\n  startId += 1;\n  return currentId;\n}\nfunction removeId(id) {\n  if (id == null) return;\n  if (fnMap.has(id)) {\n    fnMap.delete(id);\n  }\n}\nexport const setTimeout = function (fn) {\n  let ms = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  for (var _len = arguments.length, args = new Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {\n    args[_key - 2] = arguments[_key];\n  }\n  return addId({\n    fn,\n    ms,\n    args,\n    mode: MODE.MODE_TIMEOUT\n  });\n};\nexport const clearTimeout = removeId;\nexport const setInterval = function (fn) {\n  let ms = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  for (var _len2 = arguments.length, args = new Array(_len2 > 2 ? _len2 - 2 : 0), _key2 = 2; _key2 < _len2; _key2++) {\n    args[_key2 - 2] = arguments[_key2];\n  }\n  return addId({\n    fn,\n    ms,\n    args,\n    mode: MODE.MODE_INTERVAL\n  });\n};\nexport const clearInterval = removeId;\nexport default {\n  setTimeout,\n  clearTimeout,\n  setInterval,\n  clearInterval\n};","map":{"version":3,"mappings":"AAAA,OAAOA,GAAG,MAAM,KAAK;AAErB,IAAKC,IAGJ;AAHD,WAAKA,IAAI;EACPA,+CAAgB;EAChBA,iDAAiB;AACnB,CAAC,EAHIA,IAAI,KAAJA,IAAI;AAgBT,MAAMC,KAAK,GAAG,IAAIC,GAAG,EAAyB;AAC9C,MAAMC,YAAY,GAAG,IAAIC,GAAG,EAAiB;AAC7C,IAAIC,UAAU,GAAG,KAAK;AACtB,IAAIC,OAAO,GAAG,CAAC;AAEf,SAASC,YAAY;EACnB,OAAO,IAAIC,IAAI,EAAE,CAACC,OAAO,EAAE;AAC7B;AAEA,SAASC,SAAS,CAACC,KAAoB;EACrC,MAAM;IAAEC,EAAE;IAAEC;EAAI,CAAE,GAAGF,KAAK;EAC1BC,EAAE,CAAC,GAAGC,IAAI,CAAC;AACb;AAEA,SAASC,WAAW;EAClB,IAAIX,YAAY,CAACY,IAAI,KAAK,CAAC,EAAE;EAC7BZ,YAAY,CAACa,OAAO,CAACN,SAAS,CAAC;EAC/BP,YAAY,CAACc,KAAK,EAAE;AACtB;AAEA,MAAMC,SAAS,GAAIC,eAAuB,IAAK,CAACR,KAAoB,EAAES,EAAU,KAAI;EAClF,MAAM;IAAEC,QAAQ;IAAEC,EAAE;IAAEC;EAAI,CAAE,GAAGZ,KAAK;EACpC,IAAIQ,eAAe,GAAGE,QAAQ,IAAI,CAAC,EAAE;IACnClB,YAAY,CAACqB,GAAG,CAACb,KAAK,CAAC;IACvB,IAAIY,IAAI,KAAKvB,IAAI,CAACyB,YAAY,EAAE;MAC9BxB,KAAK,CAACyB,MAAM,CAACN,EAAE,CAAC;KACjB,MAAM;MACLnB,KAAK,CAAC0B,GAAG,CAACP,EAAE,EAAE;QACZ,GAAGT,KAAK;QACRU,QAAQ,EAAEA,QAAQ,GAAGC;OACtB,CAAC;;;AAGR,CAAC;AAED,SAASM,IAAI;EACX,IAAI3B,KAAK,CAACc,IAAI,KAAK,CAAC,EAAE;IACpBV,UAAU,GAAG,KAAK;IAClB;;EAEF,MAAMc,eAAe,GAAGZ,YAAY,EAAE;EACtCN,KAAK,CAACe,OAAO,CAACE,SAAS,CAACC,eAAe,CAAC,CAAC;EACzCL,WAAW,EAAE;EACb,IAAIb,KAAK,CAACc,IAAI,KAAK,CAAC,EAAE;IACpBV,UAAU,GAAG,KAAK;IAClB;;EAEFN,GAAG,CAAC6B,IAAI,CAAC;AACX;AAEA,SAASC,KAAK,OAAkC;EAAA,IAAjC;IAAEjB,EAAE;IAAEU,EAAE;IAAET,IAAI;IAAEU;EAAI,CAAa;EAC9C,IAAI,CAACX,EAAE,EAAE,OAAO,IAAI;EACpB,MAAMkB,SAAS,GAAGxB,OAAO;EACzBL,KAAK,CAAC0B,GAAG,CAACG,SAAS,EAAE;IACnBlB,EAAE;IACFU,EAAE;IACFD,QAAQ,EAAEd,YAAY,EAAE,GAAGe,EAAE;IAC7BT,IAAI;IACJU;GACD,CAAC;EACF,IAAI,CAAClB,UAAU,EAAE;IACfA,UAAU,GAAG,IAAI;IACjBN,GAAG,CAAC6B,IAAI,CAAC;;EAEXtB,OAAO,IAAI,CAAC;EACZ,OAAOwB,SAAS;AAClB;AAEA,SAASC,QAAQ,CAACX,EAAW;EAC3B,IAAIA,EAAE,IAAI,IAAI,EAAE;EAChB,IAAInB,KAAK,CAAC+B,GAAG,CAACZ,EAAE,CAAC,EAAE;IACjBnB,KAAK,CAACyB,MAAM,CAACN,EAAE,CAAC;;AAEpB;AAEA,OAAO,MAAMa,UAAU,GAAG,UAACrB,EAAY;EAAA,IAAEU,EAAE,uEAAG,CAAC;EAAA,kCAAKT,IAAW;IAAXA,IAAW;EAAA;EAAA,OAAKgB,KAAK,CAAC;IAAEjB,EAAE;IAAEU,EAAE;IAAET,IAAI;IAAEU,IAAI,EAAEvB,IAAI,CAACyB;EAAY,CAAE,CAAC;AAAA;AACpH,OAAO,MAAMS,YAAY,GAAGH,QAAQ;AACpC,OAAO,MAAMI,WAAW,GAAG,UAACvB,EAAY;EAAA,IAAEU,EAAE,uEAAG,CAAC;EAAA,mCAAKT,IAAW;IAAXA,IAAW;EAAA;EAAA,OAAKgB,KAAK,CAAC;IAAEjB,EAAE;IAAEU,EAAE;IAAET,IAAI;IAAEU,IAAI,EAAEvB,IAAI,CAACoC;EAAa,CAAE,CAAC;AAAA;AACtH,OAAO,MAAMC,aAAa,GAAGN,QAAQ;AAErC,eAAe;EAAEE,UAAU;EAAEC,YAAY;EAAEC,WAAW;EAAEE;AAAa,CAAE","names":["raf","MODE","fnMap","Map","executionSet","Set","rafStarted","startId","getTimeStamp","Date","getTime","executeFn","value","fn","args","runFunction","size","forEach","clear","checkTick","currentTimeTick","id","nextTick","ms","mode","add","MODE_TIMEOUT","delete","set","loop","addId","currentId","removeId","has","setTimeout","clearTimeout","setInterval","MODE_INTERVAL","clearInterval"],"sources":["../src/index.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}